type TransformArgs = 
 record {
   context: blob;
   response: HttpResponsePayload;
 };
type ToolResult = 
 variant {
   err: text;
   ok: text;
 };
type TgStatus = 
 record {
   configured: bool;
   hasLlmConfig: bool;
   hasSecret: bool;
 };
type SessionSummary = 
 record {
   id: text;
   messageCount: nat;
   updatedAtNs: int;
 };
type SendResult = 
 variant {
   err: text;
   ok: SendOk;
 };
type SendOptions = 
 record {
   apiKey: text;
   includeHistory: bool;
   maxTokens: opt nat;
   model: text;
   provider: Provider;
   skillNames: vec text;
   systemPrompt: opt text;
   temperature: opt float64;
 };
type SendOk = 
 record {
   assistant: ChatMessage;
   raw: opt text;
 };
type Role = 
 variant {
   assistant;
   system;
   tool;
   user;
 };
type Result = 
 variant {
   err: text;
   ok: text;
 };
type Provider = 
 variant {
   anthropic;
   google;
   openai;
 };
type ModelsResult = 
 variant {
   err: text;
   ok: vec text;
 };
type InHttpResponse = 
 record {
   body: blob;
   headers: vec HeaderField;
   status_code: nat16;
   streaming_strategy:
    opt
     variant {Callback: record {
                          callback: func () -> () query;
                          token: blob;
                        };};
   upgrade: opt bool;
 };
type InHttpRequest = 
 record {
   body: blob;
   headers: vec HeaderField;
   method: text;
   url: text;
 };
type HttpResponsePayload = 
 record {
   body: blob;
   headers: vec HttpHeader;
   status: nat;
 };
type HttpHeader = 
 record {
   name: text;
   value: text;
 };
type HeaderField = 
 record {
   text;
   text;
 };
type ChatMessage = 
 record {
   content: text;
   role: Role;
   tsNs: int;
 };
service : {
  admin_set_llm_opts: (opts: SendOptions) -> ();
  admin_set_tg: (botToken: text, secretToken: opt text) -> ();
  admin_tg_set_webhook: (webhookUrl: text) -> (Result);
  http_request: (req: InHttpRequest) -> (InHttpResponse) query;
  http_request_update: (req: InHttpRequest) -> (InHttpResponse);
  http_transform: (args: TransformArgs) -> (HttpResponsePayload) query;
  models_list: (provider: Provider, apiKey: text) -> (ModelsResult);
  sessions_create: (sessionId: text) -> ();
  sessions_history: (sessionId: text, limit: nat) -> (vec ChatMessage);
  sessions_list: () -> (vec SessionSummary);
  sessions_list_for: ("principal": principal) -> (vec SessionSummary) query;
  sessions_reset: (sessionId: text) -> ();
  sessions_send: (sessionId: text, message: text, opts: SendOptions) ->
   (SendResult);
  skills_delete: (name: text) -> (bool);
  skills_get: (name: text) -> (opt text);
  skills_list: () -> (vec text);
  skills_put: (name: text, markdown: text) -> ();
  tg_status: () -> (TgStatus);
  tools_invoke: (name: text, args: vec text) -> (ToolResult);
  tools_list: () -> (vec text);
}
